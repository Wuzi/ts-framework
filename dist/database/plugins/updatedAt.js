"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function UpdatedAtPlugin(schema, options) {
    schema.add({ updated_at: { type: Date, defaults: Date.now } });
    schema.pre('save', function (next) {
        this.updated_at = new Date();
        next();
    });
    schema.pre('update', function () {
        this.update({}, {
            $set: { updated_at: new Date() },
        });
    });
    schema.pre('findOneAndUpdate', function () {
        this.update({}, { $set: { updated_at: new Date() } });
    });
    if (options && options.index) {
        schema.path('updated_at').index(options.index);
    }
}
exports.default = UpdatedAtPlugin;
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlZEF0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2RhdGFiYXNlL3BsdWdpbnMvdXBkYXRlZEF0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEseUJBQXdDLE1BQU0sRUFBRSxPQUFPO0lBQ3JELE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRS9ELE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLFVBQVUsSUFBSTtRQUMvQixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDN0IsSUFBSSxFQUFFLENBQUM7SUFDVCxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFO1FBQ25CLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFO1lBQ2QsSUFBSSxFQUFFLEVBQUUsVUFBVSxFQUFFLElBQUksSUFBSSxFQUFFLEVBQUU7U0FDakMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxNQUFNLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFO1FBQzdCLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsVUFBVSxFQUFFLElBQUksSUFBSSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDN0IsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pELENBQUM7QUFDSCxDQUFDO0FBckJELGtDQXFCQztBQUFBLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBVcGRhdGVkQXRQbHVnaW4oc2NoZW1hLCBvcHRpb25zKSB7XG4gIHNjaGVtYS5hZGQoeyB1cGRhdGVkX2F0OiB7IHR5cGU6IERhdGUsIGRlZmF1bHRzOiBEYXRlLm5vdyB9IH0pO1xuXG4gIHNjaGVtYS5wcmUoJ3NhdmUnLCBmdW5jdGlvbiAobmV4dCkge1xuICAgIHRoaXMudXBkYXRlZF9hdCA9IG5ldyBEYXRlKCk7XG4gICAgbmV4dCgpO1xuICB9KTtcblxuICBzY2hlbWEucHJlKCd1cGRhdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy51cGRhdGUoe30sIHtcbiAgICAgICRzZXQ6IHsgdXBkYXRlZF9hdDogbmV3IERhdGUoKSB9LFxuICAgIH0pO1xuICB9KTtcblxuICBzY2hlbWEucHJlKCdmaW5kT25lQW5kVXBkYXRlJywgZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudXBkYXRlKHt9LCB7ICRzZXQ6IHsgdXBkYXRlZF9hdDogbmV3IERhdGUoKSB9IH0pO1xuICB9KTtcblxuICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmluZGV4KSB7XG4gICAgc2NoZW1hLnBhdGgoJ3VwZGF0ZWRfYXQnKS5pbmRleChvcHRpb25zLmluZGV4KTtcbiAgfVxufTtcbiJdfQ==