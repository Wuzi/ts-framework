"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util = require("util");
const HttpError_1 = require("../error/http/HttpError");
const HttpCode_1 = require("../error/http/HttpCode");
exports.default = {
    error(res) {
        return (error) => {
            if (error instanceof HttpError_1.default) {
                res.status(error.status).json(error.toJSON());
            }
            else if (typeof error === 'string') {
                res.status(HttpCode_1.HttpServerErrors.INTERNAL_SERVER_ERROR).json({
                    message: error,
                    stack: (new Error()).stack,
                    details: {}
                });
            }
            else {
                res.status(error.status || HttpCode_1.HttpServerErrors.INTERNAL_SERVER_ERROR).json({
                    message: error.message,
                    stack: error.stack,
                    details: error,
                });
            }
        };
    },
    success(res) {
        return (data) => {
            if (data && util.isArray(data)) {
                data = data.map(d => (d && util.isFunction(d.toJSON)) ? d.toJSON() : d);
            }
            else if (data && util.isFunction(data.toJSON)) {
                data = data.toJSON();
            }
            res.status(HttpCode_1.HttpSuccess.OK).json(data || {});
        };
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzcG9uc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvc2VydmVyL2hlbHBlcnMvcmVzcG9uc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNkI7QUFJN0IsdURBQStEO0FBQy9ELHFEQUF1RTtBQXNCdkUsa0JBQWU7SUFFYixLQUFLLENBQUMsR0FBYTtRQUNqQixNQUFNLENBQUMsQ0FBQyxLQUFpQyxFQUFFLEVBQUU7WUFDM0MsRUFBRSxDQUFDLENBQUMsS0FBSyxZQUFZLG1CQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUMvQixHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzFELENBQUM7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDckMsR0FBRyxDQUFDLE1BQU0sQ0FBQywyQkFBZ0IsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDdEQsT0FBTyxFQUFFLEtBQUs7b0JBQ2QsS0FBSyxFQUFFLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUs7b0JBQzFCLE9BQU8sRUFBRSxFQUFFO2lCQUNaLENBQUMsQ0FBQztZQUNMLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixHQUFHLENBQUMsTUFBTSxDQUFFLEtBQWEsQ0FBQyxNQUFNLElBQUksMkJBQWdCLENBQUMscUJBQXFCLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQy9FLE9BQU8sRUFBRyxLQUFhLENBQUMsT0FBTztvQkFDL0IsS0FBSyxFQUFHLEtBQWEsQ0FBQyxLQUFLO29CQUMzQixPQUFPLEVBQUUsS0FBSztpQkFDZixDQUFDLENBQUM7WUFDTCxDQUFDO1FBQ0gsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztJQUVELE9BQU8sQ0FBQyxHQUFhO1FBQ25CLE1BQU0sQ0FBQyxDQUFDLElBQVUsRUFBRSxFQUFFO1lBQ3BCLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDL0IsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFFLENBQUM7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEQsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUN2QixDQUFDO1lBQ0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxzQkFBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUE7UUFDN0MsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB1dGlsIGZyb20gXCJ1dGlsXCI7XG5pbXBvcnQgeyBMb2dnZXJJbnN0YW5jZSB9IGZyb20gXCJ3aW5zdG9uXCI7XG5pbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IEJhc2VFcnJvciBmcm9tIFwiLi4vLi4vZXJyb3IvQmFzZUVycm9yXCI7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIEh0dHBFcnJvciB9IGZyb20gXCIuLi9lcnJvci9odHRwL0h0dHBFcnJvclwiO1xuaW1wb3J0IHsgSHR0cFNlcnZlckVycm9ycywgSHR0cFN1Y2Nlc3MgfSBmcm9tIFwiLi4vZXJyb3IvaHR0cC9IdHRwQ29kZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEJhc2VSZXF1ZXN0IGV4dGVuZHMgUmVxdWVzdCB7XG4gIGZpbGU/OiBhbnk7XG4gIHVzZXI/OiBhbnk7XG4gIGxvZ2dlcjogTG9nZ2VySW5zdGFuY2U7XG5cbiAgcGFyYW0obmFtZTogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBhbnkpO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJhc2VSZXNwb25zZSBleHRlbmRzIFJlc3BvbnNlIHtcbiAgZXJyb3Ioc3RhdHVzOiBudW1iZXIsIGVycm9yOiBFcnJvcik6IHZvaWQ7XG5cbiAgZXJyb3Ioc3RhdHVzOiBudW1iZXIsIGVycm9yOiBCYXNlRXJyb3IpOiB2b2lkO1xuXG4gIGVycm9yKHN0YXR1czogbnVtYmVyLCBlcnJvck1lc3NhZ2U6IHN0cmluZyk6IHZvaWQ7XG5cbiAgZXJyb3IoZXJyb3I6IEh0dHBFcnJvcik6IHZvaWQ7XG5cbiAgc3VjY2VzcyhkYXRhPzogYW55KTogdm9pZDtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuXG4gIGVycm9yKHJlczogUmVzcG9uc2UpIHtcbiAgICByZXR1cm4gKGVycm9yOiBTdHJpbmcgfCBFcnJvciB8IEh0dHBFcnJvcikgPT4ge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgSHR0cEVycm9yKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoZXJyb3Iuc3RhdHVzIGFzIG51bWJlcikuanNvbihlcnJvci50b0pTT04oKSk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlcnJvciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmVzLnN0YXR1cyhIdHRwU2VydmVyRXJyb3JzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IsXG4gICAgICAgICAgc3RhY2s6IChuZXcgRXJyb3IoKSkuc3RhY2ssXG4gICAgICAgICAgZGV0YWlsczoge31cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuc3RhdHVzKChlcnJvciBhcyBhbnkpLnN0YXR1cyB8fCBIdHRwU2VydmVyRXJyb3JzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogKGVycm9yIGFzIGFueSkubWVzc2FnZSxcbiAgICAgICAgICBzdGFjazogKGVycm9yIGFzIGFueSkuc3RhY2ssXG4gICAgICAgICAgZGV0YWlsczogZXJyb3IsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBzdWNjZXNzKHJlczogUmVzcG9uc2UpIHtcbiAgICByZXR1cm4gKGRhdGE/OiBhbnkpID0+IHtcbiAgICAgIGlmIChkYXRhICYmIHV0aWwuaXNBcnJheShkYXRhKSkge1xuICAgICAgICBkYXRhID0gZGF0YS5tYXAoZCA9PiAoZCAmJiB1dGlsLmlzRnVuY3Rpb24oZC50b0pTT04pKSA/IGQudG9KU09OKCkgOiBkKTtcbiAgICAgIH0gZWxzZSBpZiAoZGF0YSAmJiB1dGlsLmlzRnVuY3Rpb24oZGF0YS50b0pTT04pKSB7XG4gICAgICAgIGRhdGEgPSBkYXRhLnRvSlNPTigpO1xuICAgICAgfVxuICAgICAgcmVzLnN0YXR1cyhIdHRwU3VjY2Vzcy5PSykuanNvbihkYXRhIHx8IHt9KVxuICAgIH1cbiAgfVxufTtcbiJdfQ==